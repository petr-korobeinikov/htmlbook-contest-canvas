<!DOCTYPE html>
<html>
<head>
<meta charset=UTF-8">
<title>Плитки майя [Htmlbook.ru Contest]</title>
<style type="text/css">
#game-field {
	width: 217px;
}

.cell {
	border-bottom: 1px solid black;
	border-right: 1px solid black;
	float: left;
	height: 30px;
	width: 30px;
}

.d { background: #fcc; }
.f { background: #fff; }
.w { background: #ccc; }
.g { background: #aaa; }
.b { background: #000; }
</style>
<script type="text/javascript">
"use strict";

var game = {};

// Контейнер игры
game.gameFieldContainer = null;

// Счетчик ходов
game.motionCount = 0;

// Текущая двигаемая фишка
game.activeChip = null;

// Состояние поля в данный момент игры
game.currentField = [];

// Поле для новой игры
// d - doomed
// w - white
// b - black
// g - gray
// f - free
game.defaultField = [
	[{type: 'd'}, {type: 'd'}, {type: 'd'}, {type: 'w'}, {type: 'd'}, {type: 'd'}, {type: 'd'}],
	[{type: 'd'}, {type: 'd'}, {type: 'f'}, {type: 'w'}, {type: 'f'}, {type: 'd'}, {type: 'd'}],
	[{type: 'd'}, {type: 'd'}, {type: 'd'}, {type: 'w'}, {type: 'd'}, {type: 'd'}, {type: 'd'}],
	[{type: 'g'}, {type: 'g'}, {type: 'g'}, {type: 'b'}, {type: 'g'}, {type: 'g'}, {type: 'g'}],
	[{type: 'd'}, {type: 'd'}, {type: 'd'}, {type: 'w'}, {type: 'd'}, {type: 'd'}, {type: 'd'}],
	[{type: 'd'}, {type: 'd'}, {type: 'f'}, {type: 'w'}, {type: 'f'}, {type: 'd'}, {type: 'd'}],
	[{type: 'd'}, {type: 'd'}, {type: 'd'}, {type: 'w'}, {type: 'd'}, {type: 'd'}, {type: 'd'}]
];

game.startNewGame = function() {
	this.currentField = this.defaultField;
	this.renderField();
}

game.increaseMotionCount = function() {
	++this.motionCount;
	document.getElementById('motionCount').innerHTML = this.motionCount;
}

game.renderField = function() {
	var fragment = document.createDocumentFragment();
	var i = 0,
	    j = 0,
	    len,
	    innerLen,
	    row,
	    cell;

	// Очищаем поле
	this.gameFieldContainer.innerHTML = '';

	for (i = 0, len = this.currentField.length; i < len; i += 1) {
		row = this.currentField[i];
		for (j = 0, innerLen = row.length; j < innerLen; j += 1) {
			cell = document.createElement('div');
			cell.appendChild(
				document.createTextNode(' ')
			);

			cell.className = 'cell ' + row[j].type;
			console.log(row[j]);

			cell.onclick = function() {
				console.log(row[j]);
				return;

				// Ничего не делать, если ячейка не участвует в игре.
				if ('d' == row[j].type) {
					return false;
				}

				// Сделать фишку активной
				if (
					'g' == row[j].type
					|| 'w' == row[j].type
					|| 'b' == row[j].type
				) {
					this.activeChip = row[j];
					console.log(row[j]);
				}

				/*
				// Передвигаем фишку сюда,
				// т.е. меняем ячейки местами
				if (
					null !== activeChip
					&& 'cell free' == this.className
				) {
					// TODO: Проверка на "соседность" ячейки
					this.className = activeChip.className;
					activeChip.className = 'cell free';
					activeChip = null;

					// @TODO this
					game.increaseMotionCount();
				}
				*/

				//console.log(this, this.className);
				//console.info('activeChip', activeChip);
			}

			fragment.appendChild(cell);
		}
	}

	this.gameFieldContainer.appendChild(fragment);
}

game.moveChip = function() {
}



window.onload = function() {
	game.gameFieldContainer = document.getElementById('game-field');
	document.getElementById('startNewGame').onclick = function() {
		game.startNewGame();
	}
};
</script>
</head>
<body>
	<div id="game-field"></div>

	<div style="clear:both;"></div>
	<div>Ходов: <span id="motionCount">0</span></div>
	<input id="startNewGame" type="button" value="Начать новую игру!">
</body>
</html>
